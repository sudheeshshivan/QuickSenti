@(adminHeader : Html, dataSources : List[ConfigurationInfoList] , adminfooter :Html)(implicit request: RequestHeader)

@adminHeader

<link rel="stylesheet" type="text/css" href="@routes.Assets.at("stylesheets/daterangepicker-bs3.css")">


<section class="content-header">
    <h1>
        Report Page
    </h1>
</section>

<section class="content">            
                    
    <div class="row">

        <div class="col-md-12">
            <div class="box">
                <div class="box-header">
                    <h3 class="box-title">Datasource Report Charts</h3>
                </div><!-- /.box-header -->
                <div class="box-body">
                  <div class="row">

                      <div class="col col-sm-4"> 

                        <div class="form-group">
                            <label>Select Datasource</label>
                            <select class="form-control" id="datasource-field">
                                @dataSources.map{ config =>
                                  <option>@config.accountTitle</option>
                                }
                            </select>
                        </div>
                      </div>

                      <div class="col col-sm-4">         
<!--                           <div class="input-group">

                              <div class="input-group-addon">
                                  <i class="fa fa-calendar"></i>
                              </div>
                              <input type="text" class="form-control pull-right" id="datepicker">
                          </div> -->
                          <div class="form-group">
                              <label>Select Date Range</label>
                              <input type="text" class="form-control" id="datepicker">
                          </div>
                      </div>
                      <div class="col col-sm-4">
                            <!-- <input type="button" id="loadTrend" onclick="loadTrend();" class="btn btn-primary" value="Load Data">  -->
                            <div class="form-group">
                                <label>Select Chart Type</label>
                                <select class="form-control" id="chartType">
                                    <option>line</option>
                                    <option>bar</option>
                                </select>
                            </div>
                      </div> 

                      <div class="col sol-sm-10" >
                          <canvas id="myChart" width="300" height="150"></canvas>
                      </div>
                
                  </div>
                </div><!-- /.box-body -->
            </div><!-- /.box -->
        </div>

    </div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>

<script>

function drawChart(data) {

  var chartLabels = []
  var chartValues = []

  for (var i = data.length - 1; i >= 0; i--) {
    chartLabels[i] = data[i].name;
    chartValues[i] = data[i].value * -1;
    // chartValues[i] = data[i].value;

  }

  console.log(chartLabels);
  console.log(chartValues);

  var chartTypeSelect = document.getElementById("chartType");
  var chartType = chartTypeSelect.options[chartTypeSelect.selectedIndex].text;

  console.log(chartType)

  $('#myChart').replaceWith('<canvas id="myChart" width="400" height="150"></canvas>');

  // document.getElementById("myChart").innerHTML = '<canvas id="myChart"></canvas>'

  var ctx = document.getElementById("myChart").getContext('2d');

  var myChart = new Chart(ctx, {
      type: chartType,
      data: {
          labels: chartLabels,
          datasets: [{
              label: "Sentiment Value",
              backgroundColor: '#5BC0EB',
              borderColor: '#003459',
              data: chartValues,
          }]
      },
      options: {}
  });
}

</script>

@adminfooter

<script type="text/javascript">
$(function() {
    $('input[id="datepicker"]').daterangepicker({
    }, 
    function(start, end, label) {
        var startDate = start.format('YYYY-MM-DD');
        var endDate = end.format('YYYY-MM-DD');
        
        if(startDate=="Start Date" || endDate =="End Date" || startDate=="" || endDate ==""){
          $('#myChart').replaceWith('<canvas id="myChart" width="400" height="150"></canvas>');
          alert("Select Two Dates");
          return ;
        }
        if(startDate>endDate){
            $('#myChart').replaceWith('<canvas id="myChart" width="400" height="150"></canvas>');
            alert("Date Error");
            return ;
        }

        var datasourceSelect = document.getElementById("datasource-field");
        var datasource = datasourceSelect.options[datasourceSelect.selectedIndex].text;
        
        if (datasource != "iphone") {
            $('#myChart').replaceWith('<canvas id="myChart" width="400" height="150"></canvas>');
            alert("No data available for the selected datasource");
            return;
        }

        $.ajax({url: '../adminArea/getTrendData/'+startDate+'/'+endDate, success: function(result){
            console.log(result);
            if(typeof result.trendData == 'undefined'){
              $('#myChart').replaceWith('<canvas id="myChart" width="400" height="150"></canvas>');
              alert(result);              
            }
            else {        
              drawChart(result.trendData);      
            }
        }});
    });
});
</script>

